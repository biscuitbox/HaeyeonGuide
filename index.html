<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>í•™êµ ì•ˆë‚´ - 3ì¥ ì‚¬ì§„ (contain/ê³ ì •/ëª©ë¡ ì´ë™)</title>

  <style>
    html, body { height: 100%; margin: 0; }
    #wrap { position: relative; width: 100vw; height: 100vh; overflow: hidden; background:#111; }

    /* í™”ë©´(ë·°í¬íŠ¸) */
    #stage {
      position: absolute;
      inset: 0;
      overflow: hidden;
      touch-action: none; /* í™•ëŒ€/ìŠ¤í¬ë¡¤ ì œìŠ¤ì²˜ ìµœì†Œí™” */
    }

    /* ì´ë¯¸ì§€ + ë§ˆì»¤ ë ˆì´ì–´ë¥¼ í•œ ë©ì–´ë¦¬ë¡œ ì´ë™(= ì¹´ë©”ë¼ ì´ë™ íš¨ê³¼) */
    #world {
      position: absolute;
      left: 0; top: 0;
      will-change: transform;
      transition: transform 420ms ease;
    }

    #photo {
      display: block;
      max-width: none;
      user-select: none;
      -webkit-user-drag: none;
      pointer-events: none; /* ì‚¬ìš©ìê°€ ì‚¬ì§„ì„ ëˆŒëŸ¬ë„ ì•„ë¬´ ë°˜ì‘ ì—†ê²Œ */
    }

    /* ë§ˆì»¤(ì„ íƒ): "ê¸€ìë§Œ ë‘¥ë‘¥" / í´ë¦­ ë¶ˆê°€ */
    .txt-marker {
      position: absolute;
      transform: translate(-50%, -50%);
      color: #fff;
      font-weight: 900;
      font-size: 18px;
      letter-spacing: -0.5px;
      text-shadow: 0 2px 10px rgba(0,0,0,.95);
      white-space: nowrap;
      user-select: none;
      pointer-events: none; /* ë§ˆì»¤ ìì²´ í´ë¦­ ë°©ì§€ */
    }

    /* ìš°ì¸¡ íŒ¨ë„ */
    #panel{
      position:absolute; top:12px; right:12px;
      width:min(360px, calc(100vw - 24px));
      max-height:calc(100vh - 24px); overflow:auto;
      background:rgba(15,15,18,.72); color:#fff;
      border:1px solid rgba(255,255,255,.15);
      border-radius:14px; padding:12px;
      backdrop-filter:blur(10px);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      z-index: 10;
    }
    #panel h1{ font-size:14px; margin:0 0 8px 0; opacity:.9; }
    .hint{ font-size:12px; opacity:.85; line-height:1.45; margin-bottom:10px; }

    .seg{ display:flex; gap:8px; flex-wrap:wrap; margin:10px 0 12px; }
    button{
      border:0; border-radius:10px; padding:8px 10px;
      font-weight:800; cursor:pointer;
      background:rgba(255,255,255,.10); color:#fff;
    }
    button.active{ outline:2px solid rgba(47,124,255,.95); background:#2f7cff; }

    .list{ display:grid; gap:8px; margin-top:10px; }
    .item{
      padding:10px; border-radius:12px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      cursor:pointer;
    }
    .item:hover{ background:rgba(255,255,255,.12); }
    .name{ font-size:13px; font-weight:900; }
    .meta{ font-size:11px; opacity:.85; margin-top:2px; }

    #toast{
      position:absolute; left:12px; bottom:12px;
      background:rgba(0,0,0,.65); color:#fff;
      padding:10px 12px; border-radius:12px; font-size:12px;
      opacity:0; transform:translateY(8px); transition:.18s ease;
      pointer-events:none; z-index: 20;
    }
    #toast.show{ opacity:1; transform:translateY(0); }
  </style>
</head>

<body>
<div id="wrap">
  <div id="stage">
    <div id="world">
      <img id="photo" alt="school photo" />
      <div id="markersLayer"></div>
    </div>
  </div>

  <div id="panel">
    <h1>ğŸ“ ì¥ì†Œ ëª©ë¡</h1>
    <div class="hint">
      - ì‚¬ì§„ì€ <b>í™•ëŒ€/ì¶•ì†Œ/ë“œë˜ê·¸ ë¶ˆê°€</b> (ê³ ì •)<br/>
      - <b>contain</b> ëª¨ë“œ: ì‚¬ì§„ì´ ì˜ë¦¬ì§€ ì•Šê³  ëª¨ë‘ ë³´ì…ë‹ˆë‹¤.<br/>
      - ëª©ë¡ì„ ëˆ„ë¥´ë©´ í•´ë‹¹ ìœ„ì¹˜ê°€ <b>ê°€ìš´ë°ë¡œ ì˜¤ë„ë¡</b> í™”ë©´ì´ ì´ë™í•©ë‹ˆë‹¤.<br/>
      - ì¢Œí‘œëŠ” ì•„ë˜ <b>ì¢Œí‘œ ì…ë ¥ ì˜ì—­</b>ì—ì„œ ì§ì ‘ ë„£ìœ¼ì„¸ìš”.
    </div>

    <div class="seg" id="sceneTabs"></div>
    <div class="list" id="placeList"></div>
  </div>

  <div id="toast"></div>
</div>

<script>
  /********************************************************************
   * 1) ì‚¬ì§„ ì„¤ì • (íŒŒì¼ëª…: images/1.jpg, images/2.jpg, images/3.jpg)
   ********************************************************************/
  const SCENES = [
    { id: 'img1', name: 'ì‚¬ì§„ 1', src: 'images/1.jpg' },
    { id: 'img2', name: 'ì‚¬ì§„ 2', src: 'images/2.jpg' },
    { id: 'img3', name: 'ì‚¬ì§„ 3', src: 'images/3.jpg' },
  ];

  /********************************************************************
   * 2) ì¥ì†Œ ëª©ë¡
   *    âœ… ì¥ì†Œë¥¼ ì¶”ê°€/ì‚­ì œí•  ë•ŒëŠ” ì—¬ê¸° PLACESë§Œ ìˆ˜ì •í•˜ë©´ ë©ë‹ˆë‹¤.
   ********************************************************************/
  const PLACES = [
    'ë¬´í•œìƒìƒì‹¤',
    'êµë¬´ì‹¤',
    'ê³¼í•™ì‹¤',
    'í–‰ì •ì‹¤',
    'ìƒë‹´ì‹¤',
    'ë³´ê±´ì‹¤',
    'ê°€ì‚¬ì‹¤',
    // ì˜ˆ: 'ë„ì„œê´€', 'ë¯¸ìˆ ì‹¤'
  ];

  /********************************************************************
   * 3) ì¢Œí‘œ ì…ë ¥ (ì¥ë©´ë³„ë¡œ ì§ì ‘ ë„£ê³  ì‹¶ì€ ê°’ë§Œ override)
   *    - ì¢Œí‘œëŠ” 0~1 ë¹„ìœ¨(ì´ë¯¸ì§€ ê¸°ì¤€)ì…ë‹ˆë‹¤.
   *      ì˜ˆ) x:0.25 => ì´ë¯¸ì§€ ê°€ë¡œ 25% ì§€ì 
   *
   *    âœ… ì—¬ê¸°ì„œëŠ” "ì¼ë¶€ë§Œ" ì ì–´ë„ ë©ë‹ˆë‹¤.
   *       ë‚˜ë¨¸ì§€ëŠ” ìë™ìœ¼ë¡œ nullë¡œ ì±„ì›Œì ¸ ëˆ„ë½ ë°©ì§€ë©ë‹ˆë‹¤.
   ********************************************************************/
  const MARKER_OVERRIDES = {
    img1: {
      // 'ê³¼í•™ì‹¤': { x: 0.62, y: 0.41 },
    },
    img2: {
      // 'ê³¼í•™ì‹¤': { x: 0.55, y: 0.50 },
    },
    img3: {
      // 'ê³¼í•™ì‹¤': { x: 0.30, y: 0.70 },
    }
  };

  /********************************************************************
   * 4) ìë™ MARKERS ìƒì„± (PLACESë§Œ ë°”ê¾¸ë©´ ìë™ìœ¼ë¡œ ë§ì¶°ì§)
   ********************************************************************/
  function buildMarkers() {
    const markers = {};
    for (const scene of SCENES) {
      markers[scene.id] = {};
      for (const place of PLACES) {
        markers[scene.id][place] = { x: null, y: null };
      }
      // overrides ì ìš©(ìˆëŠ” ê²ƒë§Œ ë®ì–´ì“°ê¸°)
      const o = MARKER_OVERRIDES?.[scene.id] || {};
      for (const [place, pos] of Object.entries(o)) {
        if (place in markers[scene.id]) {
          markers[scene.id][place] = {
            x: (typeof pos?.x === 'number') ? pos.x : null,
            y: (typeof pos?.y === 'number') ? pos.y : null,
          };
        }
      }
    }
    return markers;
  }

  // ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ë§ˆì»¤ ë§µ
  const MARKERS = buildMarkers();

  /********************************************************************
   * 5) DOM ì°¸ì¡°
   ********************************************************************/
  const $photo = document.getElementById('photo');
  const $world = document.getElementById('world');
  const $markersLayer = document.getElementById('markersLayer');
  const $tabs = document.getElementById('sceneTabs');
  const $list = document.getElementById('placeList');
  const $toast = document.getElementById('toast');
  const $stage = document.getElementById('stage');

  let currentSceneId = SCENES[0].id;

  function toast(msg) {
    $toast.textContent = msg;
    $toast.classList.add('show');
    clearTimeout(toast._t);
    toast._t = setTimeout(() => $toast.classList.remove('show'), 1200);
  }

  /********************************************************************
   * 6) ë§ˆì»¤ ë Œë”ë§
   ********************************************************************/
  function clearMarkers() {
    $markersLayer.innerHTML = '';
  }

  function addMarker(label, x, y) {
    const el = document.createElement('div');
    el.className = 'txt-marker';
    el.textContent = label;
    el.style.left = `${x * 100}%`;
    el.style.top  = `${y * 100}%`;
    $markersLayer.appendChild(el);
  }

  function renderMarkers() {
    clearMarkers();
    const sceneMap = MARKERS[currentSceneId] || {};
    for (const place of PLACES) {
      const p = sceneMap[place];
      if (!p || p.x == null || p.y == null) continue;
      addMarker(place, p.x, p.y);
    }
  }

  /********************************************************************
   * 7) contain ë ˆì´ì•„ì›ƒ + ì´ë™(moveTo)
   ********************************************************************/
  function layoutContain() {
    const sw = $stage.clientWidth;
    const sh = $stage.clientHeight;
    const iw = $photo.naturalWidth;
    const ih = $photo.naturalHeight;
    if (!iw || !ih) return;

    // contain ìŠ¤ì¼€ì¼: ì‚¬ì§„ì´ ì˜ë¦¬ì§€ ì•Šë„ë¡
    const scale = Math.min(sw / iw, sh / ih);
    const w = iw * scale;
    const h = ih * scale;

    $photo.style.width = `${w}px`;
    $photo.style.height = `${h}px`;
    $world.style.width = `${w}px`;
    $world.style.height = `${h}px`;
  }

  // íŠ¹ì • ë¹„ìœ¨ì¢Œí‘œ(x,y)ë¥¼ í™”ë©´ ì¤‘ì•™ìœ¼ë¡œ
  function moveTo(x, y) {
    const sw = $stage.clientWidth;
    const sh = $stage.clientHeight;

    const w = $photo.getBoundingClientRect().width;
    const h = $photo.getBoundingClientRect().height;

    const cx = x * w;
    const cy = y * h;

    let tx = (sw / 2) - cx;
    let ty = (sh / 2) - cy;

    // containì—ì„œëŠ” worldê°€ stageë³´ë‹¤ ì‘ì„ ìˆ˜ ìˆìœ¼ë‹ˆ "ì‘ìœ¼ë©´ ê°€ìš´ë° ê³ ì •"
    if (w <= sw) {
      tx = (sw - w) / 2;
    } else {
      const minTx = sw - w;
      tx = Math.min(0, Math.max(minTx, tx));
    }

    if (h <= sh) {
      ty = (sh - h) / 2;
    } else {
      const minTy = sh - h;
      ty = Math.min(0, Math.max(minTy, ty));
    }

    $world.style.transform = `translate(${tx}px, ${ty}px)`;
  }

  /********************************************************************
   * 8) íƒ­/ëª©ë¡ UI
   ********************************************************************/
  function renderTabs() {
    $tabs.innerHTML = '';
    SCENES.forEach(s => {
      const b = document.createElement('button');
      b.textContent = s.name;
      if (s.id === currentSceneId) b.classList.add('active');
      b.onclick = () => switchScene(s.id);
      $tabs.appendChild(b);
    });
  }

  function renderList() {
    $list.innerHTML = '';
    const sceneMap = MARKERS[currentSceneId] || {};

    PLACES.forEach(place => {
      const pos = sceneMap[place] || { x: null, y: null };

      const item = document.createElement('div');
      item.className = 'item';
      item.innerHTML = `
        <div class="name">${place}</div>
        <div class="meta">${(pos.x == null) ? 'ì¢Œí‘œ ë¯¸ì§€ì •' : `x:${pos.x}, y:${pos.y}`}</div>
      `;

      item.onclick = () => {
        if (pos.x == null || pos.y == null) {
          toast(`${place}: ì¢Œí‘œë¥¼ ì•„ì§ ë„£ì§€ ì•Šì•˜ì–´ìš”.`);
          return;
        }
        moveTo(pos.x, pos.y);
        toast(`${place}ë¡œ ì´ë™`);
      };

      $list.appendChild(item);
    });
  }

  /********************************************************************
   * 9) ì´ë¯¸ì§€ ë¡œë“œ / ì¥ë©´ ì „í™˜
   ********************************************************************/
  function loadImage(sceneId) {
    const scene = SCENES.find(s => s.id === sceneId);
    return new Promise((resolve, reject) => {
      $photo.onload = () => resolve();
      $photo.onerror = reject;
      $photo.src = scene.src;
    });
  }

  function firstDefinedPos(sceneId) {
    const sceneMap = MARKERS[sceneId] || {};
    for (const place of PLACES) {
      const p = sceneMap[place];
      if (p && p.x != null && p.y != null) return p;
    }
    return null;
  }

  async function switchScene(sceneId) {
    if (sceneId === currentSceneId) return;
    currentSceneId = sceneId;

    renderTabs();
    await loadImage(sceneId);

    layoutContain();
    renderMarkers();
    renderList();

    const first = firstDefinedPos(sceneId);
    if (first) moveTo(first.x, first.y);
    else moveTo(0.5, 0.5);

    toast(`${SCENES.find(s => s.id === sceneId)?.name} ì „í™˜ ì™„ë£Œ`);
  }

  /********************************************************************
   * 10) ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬
   ********************************************************************/
  window.addEventListener('resize', () => {
    layoutContain();
    // containì—ì„œëŠ” ì¤‘ì•™ ìœ ì§€ê°€ ìì—°ìŠ¤ëŸ¬ì›€
    moveTo(0.5, 0.5);
  });

  /********************************************************************
   * 11) ì´ˆê¸° ì‹œì‘
   ********************************************************************/
  (async function init() {
    renderTabs();
    await loadImage(currentSceneId);

    layoutContain();
    renderMarkers();
    renderList();

    const first = firstDefinedPos(currentSceneId);
    if (first) moveTo(first.x, first.y);
    else moveTo(0.5, 0.5);

    toast('ì¤€ë¹„ ì™„ë£Œ');
  })();
</script>
</body>
</html>
