<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>해연중 안내 - 3장 사진 (상단 목록/contain/고정)</title>

  <style>
    html, body { height: 100%; margin: 0; }
    #wrap { position: relative; width: 100vw; height: 100vh; overflow: hidden; background:#111; }

    /* 상단 바 */
    #topbar{
      position:absolute; left: 10px; right: 10px; top: 10px;
      z-index: 10;
      display: grid;
      gap: 8px;
    }
    .bar{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      padding: 8px;
      border-radius: 14px;
      background: rgba(15,15,18,.62);
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
      align-items: center;
    }

    /* 버튼 기본 */
    .btn{
      position: relative;
      border: 0;
      border-radius: 999px;
      padding: 7px 10px;
      font-weight: 900;
      cursor: pointer;
      background: rgba(255,255,255,.10);
      color: #fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      font-size: 12px;
      line-height: 1;
      user-select: none;
      white-space: nowrap;
      isolation: isolate; /* pseudo-element 레이어 분리 */
    }
    .btn.active{
      background:#2f7cff;
      outline:2px solid rgba(47,124,255,.55);
    }

    /* 뷰포트 */
    #stage{
      position:absolute;
      inset: 0;
      overflow: hidden;
      touch-action: none; /* 확대/스크롤 제스처 최소화 */
    }

    /* 이미지+마커 덩어리 (이동=카메라 이동 효과) */
    #world{
      position:absolute;
      left:0; top:0;
      will-change: transform;
      transition: transform 420ms ease;
      z-index: 1;
    }

    #photo{
      display:block;
      max-width:none;
      user-select:none;
      -webkit-user-drag:none;
      pointer-events:none;
    }

    /* 마커 레이어 */
    #markersLayer{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none; /* 기본은 none, 마커만 pointer-events:auto로 */
    }

    /* 마커(글자만 둥둥) */
    .txt-marker{
      position:absolute;
      transform: translate(-50%, -50%);
      color:#fff;
      font-weight:900;
      font-size:18px;
      letter-spacing:-0.5px;
      text-shadow:0 2px 10px rgba(0,0,0,.95);
      white-space:nowrap;
      user-select:none;
      pointer-events:auto; /* ✅ 마커 터치/클릭 가능 */
      cursor: pointer;
      isolation: isolate;
    }

    /* 토스트 */
    #toast{
      position:absolute; left:12px; bottom:12px;
      background:rgba(0,0,0,.65); color:#fff;
      padding:10px 12px; border-radius:12px; font-size:12px;
      opacity:0; transform:translateY(8px); transition:.18s ease;
      pointer-events:none; z-index: 20;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
    }
    #toast.show{ opacity:1; transform:translateY(0); }

    @media (max-width: 420px) {
      .btn { padding: 6px 9px; font-size: 11px; }
      .bar { padding: 7px; }
      .txt-marker { font-size: 16px; }
    }

    /******************************************************************
     * ✨ 화려한 강조 효과 (링 + 색변화 + 반짝임)
     * - 버튼과 마커 둘 다 동일 컨셉으로 2.6초 정도 강조
     ******************************************************************/
    @keyframes hueSpin {
      0% { filter: hue-rotate(0deg); }
      100% { filter: hue-rotate(220deg); }
    }
    @keyframes ringPulse {
      0%   { transform: translate(-50%, -50%) scale(0.85); opacity: 0; }
      12%  { transform: translate(-50%, -50%) scale(1.05); opacity: 1; }
      55%  { transform: translate(-50%, -50%) scale(1.25); opacity: 0.65; }
      100% { transform: translate(-50%, -50%) scale(1.55); opacity: 0; }
    }
    @keyframes sparkle {
      0%   { opacity: 0; transform: translate(-50%, -50%) scale(0.7) rotate(0deg); }
      15%  { opacity: 1; transform: translate(-50%, -50%) scale(1.0) rotate(20deg); }
      55%  { opacity: 0.85; transform: translate(-50%, -50%) scale(1.05) rotate(70deg); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(1.25) rotate(120deg); }
    }
    @keyframes textPop {
      0%   { transform: translate(-50%, -50%) scale(1); }
      10%  { transform: translate(-50%, -50%) scale(1.22); }
      25%  { transform: translate(-50%, -50%) scale(1.12); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    /* 마커 플래시 */
    .txt-marker.flash{
      animation: textPop 2.6s ease-out 1, hueSpin 2.6s linear 1;
      color: #dff3ff;
      text-shadow:
        0 0 10px rgba(255,255,255,.95),
        0 0 18px rgba(47,124,255,.85),
        0 2px 10px rgba(0,0,0,.95);
    }
    .txt-marker.flash::before{
      content:"";
      position:absolute;
      left:50%; top:50%;
      width: 22px; height: 22px;
      border-radius: 999px;
      border: 2px solid rgba(160, 220, 255, .95);
      box-shadow:
        0 0 0 2px rgba(47,124,255,.35),
        0 0 18px rgba(47,124,255,.9),
        0 0 30px rgba(255,255,255,.55);
      transform: translate(-50%, -50%);
      animation: ringPulse 2.6s ease-out 1, hueSpin 2.6s linear 1;
      pointer-events:none;
      z-index:-1;
    }
    .txt-marker.flash::after{
      content:"✦";
      position:absolute;
      left:50%; top:50%;
      font-size: 18px;
      color: rgba(255,255,255,.95);
      text-shadow: 0 0 18px rgba(255,255,255,.9), 0 0 28px rgba(47,124,255,.85);
      transform: translate(-50%, -50%);
      animation: sparkle 2.6s ease-out 1, hueSpin 2.6s linear 1;
      pointer-events:none;
      z-index:-1;
    }

    /* 버튼 플래시(링은 버튼 밖으로) */
    @keyframes btnPulse {
      0%   { transform: scale(1); }
      10%  { transform: scale(1.08); }
      25%  { transform: scale(1.04); }
      100% { transform: scale(1); }
    }
    @keyframes btnRing {
      0%   { transform: scale(0.95); opacity: 0; }
      12%  { transform: scale(1.05); opacity: 1; }
      55%  { transform: scale(1.18); opacity: 0.65; }
      100% { transform: scale(1.32); opacity: 0; }
    }

    .btn.flash{
      animation: btnPulse 2.6s ease-out 1, hueSpin 2.6s linear 1;
      background: rgba(255,255,255,.14);
      box-shadow:
        0 0 0 2px rgba(47,124,255,.35),
        0 0 18px rgba(47,124,255,.85);
    }
    .btn.flash::before{
      content:"";
      position:absolute;
      inset:-6px;
      border-radius: 999px;
      border: 2px solid rgba(160, 220, 255, .92);
      box-shadow:
        0 0 0 2px rgba(47,124,255,.25),
        0 0 18px rgba(47,124,255,.85),
        0 0 30px rgba(255,255,255,.45);
      animation: btnRing 2.6s ease-out 1, hueSpin 2.6s linear 1;
      pointer-events:none;
      z-index:-1;
    }
    .btn.flash::after{
      content:"✦";
      position:absolute;
      right: -6px;
      top: -10px;
      font-size: 14px;
      color: rgba(255,255,255,.95);
      text-shadow: 0 0 12px rgba(255,255,255,.85), 0 0 22px rgba(47,124,255,.85);
      animation: sparkle 2.6s ease-out 1, hueSpin 2.6s linear 1;
      pointer-events:none;
      z-index: 1;
    }
  </style>
</head>

<body>
<div id="wrap">
  <div id="topbar">
    <div class="bar" id="sceneTabs"></div>
    <div class="bar" id="placeTabs"></div>
  </div>

  <div id="stage">
    <div id="world">
      <img id="photo" alt="school photo" />
      <div id="markersLayer"></div>
    </div>
  </div>

  <div id="toast"></div>
</div>

<script>
  /********************************************************************
   * 1) 사진 설정 (업로드 파일명: images/1.jpg, 2.jpg, 3.jpg)
   ********************************************************************/
  const SCENES = [
    { id: 'img1', name: '전경', src: 'images/1.jpg' },
    { id: 'img2', name: '구관', src: 'images/2.jpg' },
    { id: 'img3', name: '신관', src: 'images/3.jpg' },
  ];

   /********************************************************************
   * 2) 장소 목록 (추가/삭제는 여기만)
   ********************************************************************/
   const PLACES = [
    '구관',
    '신관',
    '강당(체육관, 급식실)',
    '별관(도서관, 영어실, 미술실)',   
    '1학년 1~4반',
    '1학년 5~8반',
    '2학년 1~5반',
    '2학년 6~7반',
    '3학년 1-7반',
    '교장실',
    '교무실',
    '행정실',
    '상담실',
    '보건실',
    '제1과학실',
    '제2과학실',
    '무한상상실',    
    '컴퓨터실',
    '정보모둠실',
    '방송실',
    '정보실',
    '가사실',    
    '무용실(소강당)',
    '음악실',
    '진로활동실',
    '학생자치실'     
  ];

  /********************************************************************
   * 3) ✅ 장소별 데이터: "어느 사진(scene)인지 + 좌표(x,y) 1세트"
   *    - 좌표는 0~1 비율(이미지 기준)
   *    - scene은 'img1' | 'img2' | 'img3'
   *
   *    좌표를 아직 모르거나 표시하지 않을 곳은 x/y를 null로 두면 됩니다.
   ********************************************************************/
  const PLACE_DATA = {
    '구관': { scene: 'img1', x: 0.612789, y: 0.408342 },
    '신관': { scene: 'img1', x: 0.35675, y: 0.377607 },
    '강당(체육관, 급식실)': { scene: 'img1', x: 0.480794, y: 0.716246 },
    '별관(도서관, 영어실, 미술실)': { scene: 'img1', x: 0.55489, y: 0.316685 },
    '1학년 1~4반': { scene: 'img2', x: 0.452669, y: 0.572464 },
    '1학년 5~8반': { scene: 'img2', x: 0.306609, y: 0.468599 },
    '2학년 1~5반': { scene: 'img2', x: 0.508375, y: 0.368357 },
    '2학년 6~7반': { scene: 'img2', x: 0.730522, y: 0.471014 },
    '3학년 1-7반': { scene: 'img3', x: 0.491391, y: 0.323671 },
    '교장실': { scene: 'img3', x: 0.331522, y: 0.484903 },
    '교무실': { scene: 'img3', x: 0.513587, y: 0.400362 },
    '행정실': { scene: 'img3', x: 0.401495, y: 0.482488 },
    '상담실': { scene: 'img3', x: 0.577446, y: 0.483696 },
    '보건실': { scene: 'img3', x: 0.203125, y: 0.477657 },
    '제1과학실': { scene: 'img3', x: 0.072011, y: 0.477657 },
    '제2과학실': { scene: 'img3', x: 0.069293, y: 0.38587 },
    '무한상상실': { scene: 'img3', x: 0.711277, y: 0.488527 },
    '컴퓨터실': { scene: 'img3', x: 0.824049, y: 0.414855 },
    '정보모둠실': { scene: 'img3', x: 0.745924, y: 0.406401 },
    '방송실': { scene: 'img3', x: 0.207201, y: 0.389493 },
    '정보실': { scene: 'img3', x: 0.338315, y: 0.394324 },
    '가사실': { scene: 'img3', x: 0.821332, y: 0.506643 },    
    '무용실(소강당)': { scene: 'img3', x: 0.194293, y: 0.57186 },
    '음악실': { scene: 'img2', x: 0.064538, y: 0.267512 },
    '진로활동실': { scene: 'img2', x: 0.0625, y: 0.36413 },
    '학생자치실': { scene: 'img2', x: 0.809783, y: 0.574275 },    
    // 예) '도서관': { scene: 'img1', x: 0.33, y: 0.62 },
  };

  /********************************************************************
   * 4) PLACES만 늘려도 누락 방지되게 자동 보정
   ********************************************************************/
  function normalizePlaceData() {
    const sceneIds = new Set(SCENES.map(s => s.id));
    for (const place of PLACES) {
      if (!PLACE_DATA[place]) PLACE_DATA[place] = { scene: SCENES[0].id, x: null, y: null };
      const d = PLACE_DATA[place];
      if (!sceneIds.has(d.scene)) d.scene = SCENES[0].id;
      if (typeof d.x !== 'number') d.x = null;
      if (typeof d.y !== 'number') d.y = null;
    }
  }
  normalizePlaceData();

  /********************************************************************
   * 5) DOM/상태
   ********************************************************************/
  const $photo = document.getElementById('photo');
  const $world = document.getElementById('world');
  const $markersLayer = document.getElementById('markersLayer');
  const $sceneTabs = document.getElementById('sceneTabs');
  const $placeTabs = document.getElementById('placeTabs');
  const $toast = document.getElementById('toast');
  const $stage = document.getElementById('stage');

  let currentSceneId = SCENES[0].id;

  function toast(msg) {
    $toast.textContent = msg;
    $toast.classList.add('show');
    clearTimeout(toast._t);
    toast._t = setTimeout(() => $toast.classList.remove('show'), 900);
  }

  /********************************************************************
   * 6) contain 레이아웃 + 이동(moveTo)
   ********************************************************************/
  function layoutContain() {
    const sw = $stage.clientWidth;
    const sh = $stage.clientHeight;
    const iw = $photo.naturalWidth;
    const ih = $photo.naturalHeight;
    if (!iw || !ih) return;

    const scale = Math.min(sw / iw, sh / ih); // contain
    const w = iw * scale;
    const h = ih * scale;

    $photo.style.width = `${w}px`;
    $photo.style.height = `${h}px`;
    $world.style.width = `${w}px`;
    $world.style.height = `${h}px`;
  }

  function moveTo(x, y) {
    const sw = $stage.clientWidth;
    const sh = $stage.clientHeight;

    const w = $photo.getBoundingClientRect().width;
    const h = $photo.getBoundingClientRect().height;

    const cx = x * w;
    const cy = y * h;

    let tx = (sw / 2) - cx;
    let ty = (sh / 2) - cy;

    if (w <= sw) tx = (sw - w) / 2;
    else {
      const minTx = sw - w;
      tx = Math.min(0, Math.max(minTx, tx));
    }

    if (h <= sh) ty = (sh - h) / 2;
    else {
      const minTy = sh - h;
      ty = Math.min(0, Math.max(minTy, ty));
    }

    $world.style.transform = `translate(${tx}px, ${ty}px)`;
  }

  /********************************************************************
   * 7) ✨ 강조(버튼/마커) — 2.6초 화려한 플래시
   ********************************************************************/
  function restartFlash(el) {
    if (!el) return;
    el.classList.remove('flash');
    void el.offsetWidth; // reflow => 애니메이션 재시작
    el.classList.add('flash');
    setTimeout(() => el.classList.remove('flash'), 2700);
  }

  function flashPlace(place) {
    const btn = $placeTabs.querySelector(`button[data-place="${CSS.escape(place)}"]`);
    restartFlash(btn);

    // 현재 씬에 렌더된 마커만 잡힘
    const mk = $markersLayer.querySelector(`.txt-marker[data-place="${CSS.escape(place)}"]`);
    restartFlash(mk);
  }

  /********************************************************************
   * 8) 마커 렌더링: "현재 사진"에 속한 장소만 표시
   ********************************************************************/
  function clearMarkers() { $markersLayer.innerHTML = ''; }

  function addMarker(label, x, y) {
    const el = document.createElement('div');
    el.className = 'txt-marker';
    el.textContent = label;
    el.dataset.place = label;
    el.style.left = `${x * 100}%`;
    el.style.top  = `${y * 100}%`;

    // ✅ 마커 터치/클릭 시: 해당 장소로 이동 + 강조
    el.addEventListener('click', async (e) => {
      e.stopPropagation();
      const d = PLACE_DATA[label];
      if (!d || d.x == null || d.y == null) return;

      if (d.scene !== currentSceneId) await switchScene(d.scene);
      moveTo(d.x, d.y);
      flashPlace(label);
      toast(`${label}로 이동`);
    });

    $markersLayer.appendChild(el);
  }

  function renderMarkersForCurrentScene() {
    clearMarkers();
    for (const place of PLACES) {
      const d = PLACE_DATA[place];
      if (!d) continue;
      if (d.scene !== currentSceneId) continue;
      if (d.x == null || d.y == null) continue;
      addMarker(place, d.x, d.y);
    }
  }

  function firstDefinedPosInScene(sceneId) {
    for (const place of PLACES) {
      const d = PLACE_DATA[place];
      if (d && d.scene === sceneId && d.x != null && d.y != null) return d;
    }
    return null;
  }

  /********************************************************************
   * 9) 상단 탭 렌더링
   ********************************************************************/
  function renderSceneTabs() {
    $sceneTabs.innerHTML = '';
    for (const s of SCENES) {
      const b = document.createElement('button');
      b.className = 'btn' + (s.id === currentSceneId ? ' active' : '');
      b.textContent = s.name;
      b.onclick = () => switchScene(s.id);
      $sceneTabs.appendChild(b);
    }
  }

  function renderPlaceTabs() {
    $placeTabs.innerHTML = '';
    for (const place of PLACES) {
      const b = document.createElement('button');
      b.className = 'btn';
      b.textContent = place;
      b.dataset.place = place;

      b.onclick = async () => {
        const d = PLACE_DATA[place];
        if (!d || d.x == null || d.y == null) {
          flashPlace(place);
          toast(`${place}: 좌표 미지정`);
          return;
        }
        if (d.scene !== currentSceneId) await switchScene(d.scene);
        moveTo(d.x, d.y);
        flashPlace(place);
        toast(`${place}로 이동`);
      };

      $placeTabs.appendChild(b);
    }
  }

  /********************************************************************
   * 10) 이미지 로드 / 장면 전환
   ********************************************************************/
  function loadImage(sceneId) {
    const scene = SCENES.find(s => s.id === sceneId);
    return new Promise((resolve, reject) => {
      $photo.onload = () => resolve();
      $photo.onerror = reject;
      $photo.src = scene.src;
    });
  }

  async function switchScene(sceneId) {
    if (sceneId === currentSceneId) return;
    currentSceneId = sceneId;

    renderSceneTabs();
    await loadImage(sceneId);

    layoutContain();
    renderMarkersForCurrentScene();
  }

  /********************************************************************
   * 11) ✅ 개발자용 좌표 찍기 모드 (Shift + 클릭)
   *     - 출력: Console + 클립보드 자동 복사
   ********************************************************************/
  function screenToRatioXY(clientX, clientY) {
    const imgRect = $photo.getBoundingClientRect();
    const rx = (clientX - imgRect.left) / imgRect.width;
    const ry = (clientY - imgRect.top) / imgRect.height;
    if (rx < 0 || rx > 1 || ry < 0 || ry > 1) return null;
    return { x: rx, y: ry };
  }

  async function copyToClipboard(text) {
    try {
      await navigator.clipboard.writeText(text);
    } catch {
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      ta.remove();
    }
  }

  $stage.addEventListener('click', async (e) => {
    if (!e.shiftKey) return;

    const pos = screenToRatioXY(e.clientX, e.clientY);
    if (!pos) {
      console.log('[좌표] 이미지 밖(여백)을 클릭했습니다.');
      toast('이미지 영역을 Shift+클릭하세요');
      return;
    }

    const x = Number(pos.x.toFixed(6));
    const y = Number(pos.y.toFixed(6));

    const snippet = `{ scene: '${currentSceneId}', x: ${x}, y: ${y} }`;
    console.log(`[좌표] scene=${currentSceneId}  x=${x}, y=${y}`);
    console.log(`[복붙용] ${snippet}`);

    await copyToClipboard(snippet);
    toast('좌표 복사됨(Shift+클릭)');
  });

  /********************************************************************
   * 12) 리사이즈
   ********************************************************************/
  window.addEventListener('resize', () => {
    layoutContain();
    // contain이면 중앙이 자연스러움
    $world.style.transform = `translate(${($stage.clientWidth - $photo.getBoundingClientRect().width)/2}px,
                                         ${($stage.clientHeight - $photo.getBoundingClientRect().height)/2}px)`;
  });

  /********************************************************************
   * 13) 초기 시작
   ********************************************************************/
  (async function init() {
    renderSceneTabs();
    renderPlaceTabs();
    await loadImage(currentSceneId);

    layoutContain();
    renderMarkersForCurrentScene();

    const first = firstDefinedPosInScene(currentSceneId);
    if (first) moveTo(first.x, first.y);
    else moveTo(0.5, 0.5);
  })();
</script>
</body>
</html>